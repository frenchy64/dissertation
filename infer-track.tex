\begin{figure*}
\begin{mathpar}

  \begin{array}{lllll}
    \trackmeta{}(\val{}, \inferpath{}) = \val{}\ ;\ \res{}\\\\

    \trackmeta{}(\num{}, \inferpath{})
    &=&
    n\ ; \{\inferpath{} : \IntT{}\}
    \\
    \trackmeta{}([\lambda \xvar{}. \exp{}, \rho], \inferpath{})
    &=&
    [
    \lambda \yvar{}.
      \trackE{((\lambda \xvar{}. \exp{}) \trackE{\yvar{}}{\appendone{\inferpath{}}{\dompe{}}})}
             {\appendone{\inferpath{}}{\rngpe{}}}
         , \rho]
         \ ; \{\inferpath{} : [\UnknownT{} \rightarrow \UnknownT{}] \}
         \\
    &&
    \text{where}\ \yvar{} \text{ is fresh}
    \\
    \trackmeta{}(\{\overrightarrow{\val1\ \val2}\}, \inferpath{})
    &=&
    \{\overrightarrow{\val1\ \val2{}'}\}
    \ ;\ \overrightarrow{\sqcup\ \res{}}
      \sqcup
    \{\inferpath{} : \{\overrightarrow{\val1\ \UnknownT{}}\} \}
    \\
    &&
    \text{where}\ \overrightarrow{\trackmeta{}(\val2, \appendone{\inferpath{}}{\inferkeype{\overrightarrow{\val1}}{\val1}}) = \val2{}'\ ;\ \res{}}
    \\
    \\

         
    \inferupdatenoalign{\aenv{}}{\tenv{}}{\inferpath{}}{\tau}{\atenv{}}
    \\\\

    \inferupdatealign{\aenv{}}{\tenv{}}{\appendone{\inferpath{}}{\inferkeype{\overrightarrow{\kw{}'}}{\kw{}}}}{\ty{}}
            {\inferupdate{\aenv{}}{\tenv{}}{\inferpath{}}{\{\overrightarrow{\kw{}' : \UnknownT{}},\ \kw{} : \ty{} \}}}
    \\
    \inferupdatealign{\aenv{}}{\tenv{}}{\appendone{\inferpath{}}{\dompe{}}}{\ty{}}
                {\inferupdate{\aenv{}}{\tenv{}}{\inferpath{}}{\arrow{\ty{}}{\UnknownT{}}}}
    \\
    \inferupdatealign{\aenv{}}{\tenv{}}{\appendone{\inferpath{}}{\rngpe{}}}{\ty{}}
                {\inferupdate{\aenv{}}{\tenv{}}{\inferpath{}}{\arrow{\UnknownT{}}{\ty{}}}}
    \\
    \inferupdatealign{\aenv{}}{\tenv{}}{[x]}{\ty{}}{(\tenv{}[\sigma / \xvar{}] , \aenv{}')}
    \\
    && \text{where}\ \tenv{}(\xvar{}) = \ty{}', join(\aenv{}, \ty{}, \ty{}') = \sigma\ ;\ \aenv{}'
    \\
    \inferupdatealign{\aenv{}}{\tenv{}}{[\xvar{}]}{\ty{}}{(\tenv{}[\ty{} / \xvar{}], \aenv{})}
    \\
    && \text{where}\ \xvar{} \not\in dom(\tenv{})
    \\

    \\
    \joinnoalign{\aenv{}}{\tau}{\tau}{\tau}
    \\ \\

    \joinalign{\aenv{}}{(\cup\ \overrightarrow{\tau_1})}{\tau}{(\cup\ \overrightarrow{\sigma})}\\
                                                    && \text{where }
                                                    \overrightarrow{\joinnoalign{\aenv{}}{\tau_1}{\tau}{\sigma}}
    \\
    \joinalign{\aenv{}}{\tau}{(\cup\ \overrightarrow{\tau_1})}{(\cup\ \overrightarrow{\sigma})} \\
                                                    && \text{where }
                                                    \overrightarrow{\joinnoalign{\aenv{}}{\tau_1}{\tau}{\sigma}}
    \\
    \joinalign{\aenv{}}{\UnknownT{}}{\tau}{\tau}
    \\
    \joinalign{\aenv{}}{\tau}{\UnknownT{}}{\tau}
    \\
    \joinalign{\aenv{}}{[\overrightarrow{\tau_1} \rightarrow \sigma_1]}{[\overrightarrow{\tau_2} \rightarrow \sigma_2]}{[\overrightarrow{\joinexpression{\aenv{}}{\tau_1}{\tau_2}}
    \rightarrow
    \joinexpression{\aenv{}}{\sigma_1}{\sigma_2}]}
    \\
    % TODO add condition on should-join-HMap?
    %join(A, (HMap\  m_1\ o_1), (HMap\  m_2\ o_2))
    %&=& joinHMap(A, (HMap\  m_1\ o_1), (HMap\  m_2\ o_2))
    %\\
    \joinalign{\aenv{}}{\tau}{\sigma}{(\cup\ \tau\ \sigma)}

  \end{array}

\end{mathpar}
\end{figure*}
